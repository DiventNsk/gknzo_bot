# Структура приложения gknzo_bot

## Шапка главной страницы после регистрации

После регистрации и входа в систему пользователь попадает на главную страницу приложения в режим "Отчеты". В шапке (верхней части) страницы находятся следующие элементы:

### Для основного режима "Отчеты":
1. **Активное название кнопки**: "Корсовет" или "План дня руководителя" (в зависимости от выбранного режима)
2. **Текущая дата**: Отображается в формате "день месяц год" (например, "1 февраля 2026") под активным названием кнопки
3. **Кнопка обновления**: Компактная кнопка с иконкой обновления (без текста) справа в одной строке с датой
4. **Переключатель режимов**: 
   - "Корсовет" 
   - "План дня руководителя"
5. **Список отделов**: Кнопки с названиями отделов (НП, ГИ, КД, РОП, РОМ, РОПР, РСО) с отображением количества задач
6. **Фильтр статусов задач**: В режиме "План дня руководителя" - выпадающий список для фильтрации задач по статусам

## Основные файлы

**public/script.js** — весь frontend (парсинг, рендер, логика)
**public/index.html** — основной HTML-файл приложения
**server.js** — серверная часть приложения

## Быстрые ссылки

| Функция | Файл | Строка |
|---------|------|--------|
| Авторизация | script.js | `checkAuth()` 1-10 |
| Выход из системы | script.js | `logout()` 14 |
| Главный дашборд | script.js | `renderGoogleSheetsDashboard()` ~153 |
| Переключение режимов | script.js | `switchKorsovetMode()` ~20 |
| Загрузка данных директора | script.js | `loadDirectorPlanData()` ~25 |
| Отображение задач отдела | script.js | `renderDepartmentTasks()` ~243 |
| Отображение задач всех отделов | script.js | `renderAllDepartmentsTasks()` ~250 |
| Парсинг данных отдела | script.js | `parseDepartmentData()` ~1196 |
| Парсинг данных директора | script.js | `parseDirectorPlanData()` ~1405 |

## Базовая структура интерфейса

### Режимы отображения
- **Корсовет** - основной режим отображения задач
- **План дня руководителя** - режим с данными из специальной таблицы

### Навигация
- Нижняя навигационная панель скрыта на мобильных устройствах (медиа-запрос `md:hidden`)
- Пользователь сразу попадает в режим "Отчеты" после загрузки
- Три основных раздела: "Отчеты", "Заполнить", "Директор" (но нижнее меню скрыто)

### Отображение задач
- Задачи отображаются в виде карточек на всех устройствах (вместо таблицы на десктопе)
- Каждая карточка содержит: номер задачи, название, продукт, комментарий и статус
- Цветовая кодировка статусов: зеленый (выполнено), синий (в работе), красный (не выполнено)

## Форматы данных Google Sheets

### НП, ГИ, КД, РОП, РОМ, РОПР, РСО (обычные отделы)
```
["№","ЗАДАЧИ","ПРОДУКТ","РЕЗУЛЬТАТ","КОММЕНТАРИЙ"]
["1","Задача","продукт","результат","комментарий"]
```

### Формат "План дня руководителя" (специальная таблица)
- Структура может отличаться от обычных отделов
- Обрабатывается специальной функцией `parseDirectorPlanData()`
- Может содержать заголовки "План дня" в первой строке

## Ключевые функции

### Переключение режимов (switchKorsovetMode)
- Строка ~20
- Переключает между "Корсовет" и "План дня руководителя"
- При выборе "План дня руководителя" вызывает `loadDirectorPlanData()`

### Загрузка данных директора (loadDirectorPlanData)
- Строка ~25
- Загружает данные из таблицы с ID 1LkYUZd5GlXixA8igGsjtQ-GFhEVqH2N1tU9x2vmJNDQ
- Обновляет интерфейс с новыми данными

### Отображение задач отдела (renderDepartmentTasks)
- Строка ~243
- Отображает задачи в виде карточек
- Используется в режиме "Корсовет"

### Отображение задач всех отделов (renderAllDepartmentsTasks)
- Строка ~250
- Отображает задачи всех отделов в режиме "План дня руководителя"
- Используется в режиме "План дня руководителя"

### Парсинг данных (parseDepartmentData)
- Строка ~1196
- Автоматически определяет формат по названию отдела
- Проверяет, является ли это таблицей "План дня руководителя"
- Фильтрует по текущему + предыдущему месяцу
- Сортирует недели (свежие сверху)

### Парсинг данных директора (parseDirectorPlanData)
- Строка ~1405
- Специальная функция для обработки данных из таблицы "План дня руководителя"
- Обрабатывает структуру, характерную для этой таблицы
- Создает правильную структуру задач для отображения в интерфейсе

## Переменные окружения (Railway)

```
GOOGLE_CREDENTIALS={"type":"service_account",...}
ADMIN_LOGIN=admin
ADMIN_PASSWORD=gknzo123
SYNC_TOKEN=gknzo-sync-2026
PORT=3000
```

## Локальный запуск

```bash
cd C:\Users\cordr\gknzo_bot
node server.js
```

Открыть: http://localhost:3000

## Деплой

```bash
git add .
git commit -m "описание изменений"
git push
```

## Логин/пароль (локально)

- admin / gknzo123